var m=require("mime-types"),u=require("multer")(),a=require("express")(),{QuickDB:A}=require("quick.db"),{MongoDriver:f}=require("quickmongo"),g=new f(process.env.m);(async ()=>{await g.connect().then(()=>console.log(`Connected to the database!`));var _=new A({driver:g});a.get("/",function(q,r){r.send(`<!DOCTYPE html><html><head></head><body><script>function validateForm(){var fileInput = document.getElementById('file');var file = fileInput.files[0];if (!file){alert('Please select a file');return false;}}</script></head><body><form action="/upload" method="post" enctype="multipart/form-data" onsubmit="return validateForm()"><input type="file" name="file" id="file" /><input type="submit" value="Upload"/></form></body></html>`)});a.post("/upload",u.single('file'),async function(q,r){var c=q.file.buffer,e=Buffer.from(require("crypto").randomBytes(6).toString('hex')).toString("base64");await _.set(e,{ct:m.contentType(q.file.originalname),ab:c.toString("base64")});r.send(`File <a href="/${e}">here</a>`)});a.get("/remove",async function(q,r){if(q.query.id){var c=await _.get(q.query.id);c?(await _.delete(q.query.id),r.send(`deleted ${q.query.id}`)):(r.status(404).send("404"))}else r.status(404).send("404")});a.get(/.*/,async function(q,r){var p=q.path,v=await _.get(p.replaceAll("/",""));v==null?r.status(404).send("404"):v&&(r.setHeader("Content-Type",v.ct),r.send(Buffer.from(v.ab,"base64")))});a.listen(0)})();
